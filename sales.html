<input type="hidden" id="id" />

<div class="biohead" id=fishermanName></div>

<div class="sale">
	<div id=fisher-info></div>
</div>

<div id=fishList></div>


<script>

function timestampToDate(timestamp) {
	if (timestamp != null && timestamp != ""
			&& timestamp != "undefined") {
		var date = new Date(timestamp * 1);
		var months = [ 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul',
				'Aug', 'Sep', 'Oct', 'Nov', 'Dec' ];
		var year = date.getFullYear();
		var month = months[date.getMonth()];
		var day = date.getDate();
		var hour = date.getHours();
		var min = date.getMinutes();
		var sec = date.getSeconds();

		if (min < 10)
			min = "0" + min;

		var weekday = [ 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat' ];
		var n = weekday[date.getDay()];

		var time = n + ', ' + month + '/' + day + '/' + year + ' '
				+ hour + ':' + min;

		return time;
	} else {
		return "";
	}
}

	function getFisherman(id, boatName, date) {
	
		var getUrl = "http://fresh.freshfishalerts.appspot.com/getfisherman?boatName=" + boatName;

		$
				.post(
						getUrl,
						{},
						function(data, status) {
							
							var result = jQuery.parseJSON(data);

							$("#id").val(result.ID);

							$("#fishermanName").html(
									'<img src="'+ result.image + '=s74"  width="74" />'
											+ '<p>' + result.fishermanName
											+ '<br/>' + result.boatName
											+ '</p>');

							$("#fisher-info")
									.html(
											date
													+ '<br/>'
													+ '<a href="https://www.google.com/maps/place/'+result.address + ', ' + result.city+'" target="_blank">'
													+ result.address + ', '
													+ result.city + '</a><br/>'
													+ result.phone);

							listFish(result.ID, date);
						});
	}

	function listFish(id, date) {

		var fishList = '<table><thead><tr>' + '<th>fish</th>'
				+ '<th>size(lb)</th>' + '<th><div id=priceType></div></th>'
				+ '<th>qty</th>' + '</tr></thead><tbody>';

		var getUrl = "http://fresh.freshfishalerts.appspot.com/listfish?fisherman=" + id + "&date=" + date;
		$.post(getUrl, {}, function(data, status) {

			var priceType = "$/lb";
			var lastUpdate = "";

			var results = jQuery.parseJSON(data);

			$.each(results, function(key, val) {

				priceType = val.priceType;

				fishList += '<tr><td>' + val.fish + '</td><td>' + val.weight
						+ '</td><td>$' + val.price + '</td><td>' + val.quantity
						+ '</td></tr>';

				if (lastUpdate < val.timestamp) {
					lastUpdate = val.timestamp;
				}
			});

			fishList += '</tbody></table>';

			$("#fishList").html(fishList);
			$("#priceType").html(priceType);
			$("#fisher-info").append(
					'<br/>last update: ' + timestampToDate(lastUpdate));
		});
	}

	function getDate(date) {

		var day = date.getDate();
		var month = date.getMonth() + 1;
		var year = date.getFullYear();

		if (month < 10)
			month = "0" + month;
		if (day < 10)
			day = "0" + day;

		return (year + "-" + month + "-" + day);
	}
	
	var boat = getUrlParameter("boat");
	var date = getUrlParameter("date");

	if (date == null || date == 'null' || date == "" || date == "undefined") {
		date = getDate(new Date());
	}

	getFisherman(id, boat, date);
</script>
