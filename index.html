<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Freshr</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

	<link rel="stylesheet" type="text/css" href="/css/entry.css">
	<link rel="stylesheet" type="text/css" href="/css/distribview.css">
	<link rel="stylesheet" type="text/css" href="/css/responsive-nav.css">

	<!-- <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'> -->
	<!-- <link href='http://fonts.googleapis.com/css?family=Alegreya+Sans+SC' rel='stylesheet' type='text/css'> -->
	<!-- <link href='http://fonts.googleapis.com/css?family=Karla' rel='stylesheet' type='text/css'> -->
	<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>


	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script>
		window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')
	</script>


	<script src="/css/responsive-nav.js"></script>


	<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDY0kkJiTPVd2U7aTOAwhc9ySH6oHxOIYM&sensor=false"></script>

	<script src="./utilities.js"></script>
	<script>
		var nav = responsiveNav(".nav-collapse");

		(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

		ga('create', 'UA-59204009-1', 'auto');
		ga('send', 'pageview');
	</script>


</head>

<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#" onclick="fishMap()">Back</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li><a href="#" onclick="openFisherman()">I'm a Fisherman</a>
					</li>
					<li><a href="#" onclick="openDistributor()">I'm a Distributor</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div id="top"></div>

	<div id="googleMap"></div>

	<div id="main"></div>
	<div id="listdistributors"></div>

	<script>
		$('.navbar-toggle').click(function() {
			if ($('#navbar').hasClass('collapse')) {
				$('#navbar').removeClass('collapse');
			}
			else {
				$('#navbar').addClass('collapse');
			}
		});

		function fishMap() {
			window.location.href = './';
		}

		function openFisherman() {
			window.location.href = './fisherman/';
		}

		function openDistributor() {
			window.location.href = './distributor/';
		}


		function getUser(email) {

			var getUrl = "http://fresh.freshfishalerts.appspot.com/getuser?email=" + email;

			$.post(getUrl, {}, function(data, status) {

				var result = jQuery.parseJSON(data);

				if ("fisherman" == result.usertype) {
					window.location.href = './fisherman/';
				}
				else
				if ("distributor" == result.usertype) {
					window.location.href = './distributor/';
				}



			});
		}


		if (getUrlParameter("email") != null && getUrlParameter("email") != "") {
			getUser(getUrlParameter("email"));
		}


		if (getUrlParameter("sales") != null && getUrlParameter("sales") != "") {
			window.location.href = "boatsales.html?sales=" + encodeURIComponent(getUrlParameter("sales"));
		}
		else if (getUrlParameter("boat") != null && getUrlParameter("boat") != "") {
			$("#top").load("sales.html");
			$("#googleMap").empty();
			$("#main").empty();
		}
		else
		if (getUrlParameter("distributorsales") != null && getUrlParameter("distributorsales") != "") {
			$("#top").load("distributorsales.html");
			$("#googleMap").empty();
			$("#main").empty();
		}
		else if ((getUrlParameter("email") == null || getUrlParameter("email") == "") && getCookie("email") != '') {
			window.location.href = './?email=' + getCookie("email");
		}

		else {
			$("#top").load("buyersTop.html");
		}


		var geocoder;
		var map;

		function codeAddress(address, boat, name) {
			geocoder.geocode({
				'address': address
			}, function(results, status) {

				if (status == google.maps.GeocoderStatus.OK) {

					//map.setCenter(results[0].geometry.location);
					var marker = new google.maps.Marker({
						map: map,
						position: results[0].geometry.location,
						title: boat + ' - ' + name,
						url: "/?boat=" + encodeURIComponent(boat),
						animation: google.maps.Animation.DROP
					});

					google.maps.event.addListener(marker, 'click', function() {
						window.location.href = marker.url;
					});
				}
			});
		}

		function initialize() {

			geocoder = new google.maps.Geocoder();

			var myLatlng = new google.maps.LatLng(21.296687, -157.856515);
			//	var myLatlng = new google.maps.LatLng(37.4737399, -122.4472172);
			if ("Half Moon Bay, San Francisco" == decodeURIComponent(getUrlParameter("city"))) {
				myLatlng = new google.maps.LatLng(37.4737399, -122.4472172);
			}
			var mapProp = {
				center: myLatlng,
				zoom: 10
			};

			map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

			listFisherman();
			listDistributors();
		}

		var city = decodeURIComponent(getUrlParameter("city"));
		if (city == null || city == "" || city == "undefined") {
			city = "Honolulu, HI";
		}

		function listFisherman() {
			var getUrl = "http://fresh.freshfishalerts.appspot.com/listfisherman?city=" + city;

			$
				.post(
					getUrl, {},
					function(data, status) {

						var results = jQuery.parseJSON(data);
						var list = '<div id="table">';
						$
							.each(
								results,
								function(key, val) {

									list += '<div class="row"><span class="cell primary" data-label="fisherman" onclick=sales("' + encodeURIComponent(val.boatName) + '");>' + '<img style="border-radius: 30px;" width=30 height=30 src="' + val.image + '=s30" /> ' + val.boatName + ' - ' + val.fishermanName + '</span>' + '<span class="cell" data-label="count" onclick=sales("' + encodeURIComponent(val.boatName) + '");>' + val.address + '</span>' + '<span class="cell" data-label="$"></span>' + '<span class="cell" data-label="lbs"></span>' + '</div>';

									codeAddress(val.address + " " + val.city, val.boatName, val.fishermanName);
								});
						list += '</div>';

						$("#main").html(list);
					});
		}

		function listDistributors() {
			var getUrl = "http://fresh.freshfishalerts.appspot.com/listdistributors?city=" + city;

			$
				.post(
					getUrl, {},
					function(data, status) {

						var results = jQuery.parseJSON(data);
						var list = '<div id="table">';
						$
							.each(
								results,
								function(key, val) {

									list += '<div class="row"><span class="cell primary" data-label="fisherman" onclick=distributorsales("' + encodeURIComponent(val.distributor) + '");>' + '<img style="border-radius: 30px;" width=30 height=30 src="' + val.image + '=s30" /> ' + val.distributor + '</span>' + '<span class="cell" data-label="count" onclick=distributorsales("' + encodeURIComponent(val.distributor) + '");>' + val.address + '</span>' + '<span class="cell" data-label="$"></span>' + '<span class="cell" data-label="lbs"></span>' + '</div>';

									codeAddress(val.address + " " + val.city, val.distributor, val.contactName);
								});
						list += '</div>';

						$("#listdistributors").html(list);
					});
		}

		function sales(boat) {
			var url = "?boat=" + encodeURIComponent(boat);
			if (getUrlParameter("distributor") != null && getUrlParameter("distributor") != "") {
				url += "&distributor=" + getUrlParameter("distributor");
			}
			window.location.href = url;
		}

		function distributorsales(distributorsales) {
			var url = "?distributorsales=" + encodeURIComponent(distributorsales);
			if (getUrlParameter("distributor") != null && getUrlParameter("distributor") != "") {
				url += "&distributor=" + getUrlParameter("distributor");
			}
			window.location.href = url;
		}

		if ((getUrlParameter("boat") == null || getUrlParameter("boat") == "") && (getUrlParameter("distributorsales") == null || getUrlParameter("distributorsales") == "")) {
			google.maps.event.addDomListener(window, 'load', initialize);
		}
	</script>


</body>

</html>
