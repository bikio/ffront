<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Freshr</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

	<link rel="stylesheet" type="text/css" href="/css/entry.css">
	<link rel="stylesheet" type="text/css" href="/css/distribview.css">
	<link rel="stylesheet" type="text/css" href="/css/responsive-nav.css">

	<!-- <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'> -->
	<!-- <link href='http://fonts.googleapis.com/css?family=Alegreya+Sans+SC' rel='stylesheet' type='text/css'> -->
	<!-- <link href='http://fonts.googleapis.com/css?family=Karla' rel='stylesheet' type='text/css'> -->
	<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>


	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script>
		window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')
	</script>


	<script src="/css/responsive-nav.js"></script>
	<script>
		var nav = responsiveNav(".nav-collapse");
	</script>

	<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDY0kkJiTPVd2U7aTOAwhc9ySH6oHxOIYM&sensor=false"></script>

</head>

<body>

	<div id="top"></div>

	<div id="googleMap"></div>

	<div id="main"></div>

	<script>
		function getUrlParameter(urlParameterName) {
			if (urlParameterName = (new RegExp('[?&]' + encodeURIComponent(urlParameterName) + '=([^&]*)'))
				.exec(location.search)) {
				return decodeURIComponent(urlParameterName[1]);
			}
		}

		if (getUrlParameter("boat") != null && getUrlParameter("boat") != "") {
			$("#top").load("sales.html");
			$("#googleMap").empty();
			$("#main").empty();
		}
		else {
			$("#top").load("buyersTop.html");
		}

		(function(b, o, i, l, e, r) {
			b.GoogleAnalyticsObject = l;
			b[l] || (b[l] = function() {
				(b[l].q = b[l].q || []).push(arguments)
			});
			b[l].l = +new Date;
			e = o.createElement(i);
			r = o.getElementsByTagName(i)[0];
			e.src = '//www.google-analytics.com/analytics.js';
			r.parentNode.insertBefore(e, r)
		}(window, document, 'script', 'ga'));
		ga('create', 'UA-XXXXX-X');
		ga('send', 'pageview');

		var geocoder;
		var map;

		function codeAddress(address, name) {
			geocoder.geocode({
				'address': address
			}, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
					//map.setCenter(results[0].geometry.location);
					var marker = new google.maps.Marker({
						map: map,
						position: results[0].geometry.location,
						title: name
					});
				}
			});
		}

		function initialize() {

			geocoder = new google.maps.Geocoder();

			var myLatlng = new google.maps.LatLng(21.296687, -157.856515);
			//	var myLatlng = new google.maps.LatLng(37.4737399, -122.4472172);
			if ("Half Moon Bay, San Francisco" == decodeURIComponent(getUrlParameter("city"))) {
				myLatlng = new google.maps.LatLng(37.4737399, -122.4472172);
			}
			var mapProp = {
				center: myLatlng,
				zoom: 10
			};

			map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

			listFish();
		}


		var city = decodeURIComponent(getUrlParameter("city"));
		if (city == null || city == "" || city == "undefined") {
			city = "Honolulu, HI";
		}

		function listFish() {
			var getUrl = "http://fresh.freshfishalerts.appspot.com/listfisherman?city=" + city;

			$
				.post(
					getUrl, {},
					function(data, status) {
						var results = jQuery.parseJSON(data);
						var list = '<table>';
						var list1 = '<div id="table">';
						$
							.each(
								results,
								function(key, val) {

									list1 += '<div class="row">' 
									+ '<span class="cell primary" data-label="fisherman" onclick=sales("' + val.boatName + '")>' 
									+ '<img style="border-radius: 40px;" width=50 height=50 src="' + val.image + '=s50" /></a> ' + val.boatName + ' - '
									+ val.fishermanName + '</span>'
									+ '<span class="cell" data-label="count" onclick=sales("' + val.boatName + '")>' + val.address + '</span>' 
									+ '<span class="cell" data-label="$"></span>' 
									+ '<span class="cell" data-label="lbs"></span>' + '</div>';

									list += '<tr><td>' + '<a onclick=openFishPage("' + val.ID + '");>' + '<img width=70 height=70 src="' + val.image + '=s70" /></a></td>' + '<td><a onclick=openFishPage("' + val.ID + '");><font size=2><b> ' + val.boatName + " - " + val.fishermanName + '<br/> ' + val.address + '<br/> License #' + val.license + '</b></font></a></td></tr>';
									codeAddress(
										val.address,
										val.boatName + " - " + val.fishermanName);
								});
						list += '</table>';
						list1 += '</div>';

						$("#main").html(list1);
					});
		}

		function sales(boat) {
			window.location.href = "?boat=" + boat;
		}

		if (getUrlParameter("boat") == null || getUrlParameter("boat") == "") {
			google.maps.event.addDomListener(window, 'load', initialize);
		}
	</script>


</body>

</html>
