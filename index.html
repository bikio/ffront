<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Freshr</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

	<link rel="stylesheet" type="text/css" href="/css/entry.css">
	<link rel="stylesheet" type="text/css" href="/css/distribview.css">
	<link rel="stylesheet" type="text/css" href="/css/responsive-nav.css">

	<!-- <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'> -->
	<!-- <link href='http://fonts.googleapis.com/css?family=Alegreya+Sans+SC' rel='stylesheet' type='text/css'> -->
	<!-- <link href='http://fonts.googleapis.com/css?family=Karla' rel='stylesheet' type='text/css'> -->
	<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>


	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script>
		window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')
	</script>


	<script src="/css/responsive-nav.js"></script>
	<script>
		var nav = responsiveNav(".nav-collapse");
	</script>

	<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDY0kkJiTPVd2U7aTOAwhc9ySH6oHxOIYM&sensor=false"></script>

</head>

<body>

	<div id="top"></div>

	<div id="googleMap"></div>

	<div id="main"></div>

	<script>
		function getUrlParameter(urlParameterName) {
			if (urlParameterName = (new RegExp('[?&]' + encodeURIComponent(urlParameterName) + '=([^&]*)'))
				.exec(location.search)) {
				return decodeURIComponent(urlParameterName[1]);
			}
		}

		if (getUrlParameter("boat") != null && getUrlParameter("boat") != "") {
			$("#top").load("sales.html");
			$("#googleMap").empty();
			$("#main").empty();
		}
		else {
			$("#top").load("buyersTop.html");
		}

		(function(b, o, i, l, e, r) {
			b.GoogleAnalyticsObject = l;
			b[l] || (b[l] = function() {
				(b[l].q = b[l].q || []).push(arguments)
			});
			b[l].l = +new Date;
			e = o.createElement(i);
			r = o.getElementsByTagName(i)[0];
			e.src = '//www.google-analytics.com/analytics.js';
			r.parentNode.insertBefore(e, r)
		}(window, document, 'script', 'ga'));
		ga('create', 'UA-XXXXX-X');
		ga('send', 'pageview');

		var geocoder;
		var map;

		function codeAddress(address, boat, name) {
			geocoder.geocode({
				'address': address
			}, function(results, status) {

				if (status == google.maps.GeocoderStatus.OK) {
					
					//map.setCenter(results[0].geometry.location);
					var marker = new google.maps.Marker({
						map: map,
						position: results[0].geometry.location,
						title: boat + ' - ' + name,
						url: "/?boat=" + encodeURIComponent(boat),
						animation: google.maps.Animation.DROP
					});

					google.maps.event.addListener(marker, 'click', function() {
						window.location.href = marker.url;
					});
				}
			});
		}

		function initialize() {

			geocoder = new google.maps.Geocoder();

			var myLatlng = new google.maps.LatLng(21.296687, -157.856515);
			//	var myLatlng = new google.maps.LatLng(37.4737399, -122.4472172);
			if ("Half Moon Bay, San Francisco" == decodeURIComponent(getUrlParameter("city"))) {
				myLatlng = new google.maps.LatLng(37.4737399, -122.4472172);
			}
			var mapProp = {
				center: myLatlng,
				zoom: 10
			};

			map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

			listFish();
		}




		var city = decodeURIComponent(getUrlParameter("city"));
		if (city == null || city == "" || city == "undefined") {
			city = "Honolulu, HI";
		}

		function listFish() {
			var getUrl = "http://fresh.freshfishalerts.appspot.com/listfisherman?city=" + city;

			$
				.post(
					getUrl, {},
					function(data, status) {
		
						var results = jQuery.parseJSON(data);
						var list = '<div id="table">';
						$
							.each(
								results,
								function(key, val) {

									list += '<div class="row"><span class="cell primary" data-label="fisherman" onclick=sales("'+encodeURIComponent(val.boatName)+'");>'
									+'<img style="border-radius: 30px;" width=30 height=30 src="' + val.image + '=s30" /> '
									+ val.boatName + ' - ' + val.fishermanName +'</span>' 
									+ '<span class="cell" data-label="count" onclick=sales("'+encodeURIComponent(val.boatName)+'");>' 
									+ val.address + '</span>' + '<span class="cell" data-label="$"></span>' 
									+ '<span class="cell" data-label="lbs"></span>' + '</div>';

									codeAddress(val.address + " " + val.city, val.boatName, val.fishermanName);
								});
						list += '</div>';

						$("#main").html(list);
					});
		}

		function sales(boat) {
			window.location.href = "?boat=" + encodeURIComponent(boat);
		}

		if (getUrlParameter("boat") == null || getUrlParameter("boat") == "") {
			google.maps.event.addDomListener(window, 'load', initialize);
		}
	</script>


</body>

</html>
